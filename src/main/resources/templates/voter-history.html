<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vote History - Voting System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        function showAlert(title, message, type = 'success') {
            const alertModal = document.getElementById('alertModal');
            if (!alertModal) {
                // Create alert modal if it doesn't exist
                const modal = document.createElement('div');
                modal.id = 'alertModal';
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl shadow-xl max-w-sm w-full p-6 text-center">
                        <div id="alertIcon" class="mb-4">
                            <i class="fas fa-check-circle text-green-500 text-3xl"></i>
                        </div>
                        <h3 id="alertTitle" class="text-lg font-semibold text-gray-900 mb-2">Success!</h3>
                        <p id="alertMessage" class="text-gray-600 mb-6">Operation completed successfully.</p>
                        <button onclick="closeAlert()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition">
                            OK
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
            }
            
            const alertTitle = document.getElementById('alertTitle');
            const alertMessage = document.getElementById('alertMessage');
            const alertIcon = document.getElementById('alertIcon');
            
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            
            // Set icon based on type
            if (type === 'success') {
                alertIcon.innerHTML = '<i class="fas fa-check-circle text-green-500 text-3xl"></i>';
            } else if (type === 'error') {
                alertIcon.innerHTML = '<i class="fas fa-times-circle text-red-500 text-3xl"></i>';
            } else if (type === 'warning') {
                alertIcon.innerHTML = '<i class="fas fa-exclamation-triangle text-yellow-500 text-3xl"></i>';
            }
            
            document.getElementById('alertModal').classList.remove('hidden');
            
            // Auto close after 3 seconds
            setTimeout(() => {
                document.getElementById('alertModal').classList.add('hidden');
            }, 3000);
        }

        function closeAlert() {
            document.getElementById('alertModal').classList.add('hidden');
        }

        function exportAsPDF() {
            // Call the server to generate and download an HTML file (which can be printed as PDF)
            showAlert('Export Started!', 'Your HTML report will be downloaded shortly. You can print it as PDF from your browser.', 'success');
            
            // Redirect to the PDF export endpoint
            setTimeout(() => {
                window.location.href = '/voter/history/export/pdf';
            }, 1500);
        }

        function exportAsCSV() {
            // Call the server to generate and download a CSV
            showAlert('Export Started!', 'Your CSV file will be downloaded shortly.', 'success');
            
            // Redirect to the CSV export endpoint
            setTimeout(() => {
                window.location.href = '/voter/history/export/csv';
            }, 1000);
        }

        function printHistory() {
            // Open print dialog for the current page
            window.print();
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Mobile overlay -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden" onclick="toggleSidebar()"></div>
    
    <!-- Sidebar -->
    <div id="sidebar" class="fixed left-0 top-0 w-64 h-full bg-gradient-to-b from-indigo-900 via-indigo-800 to-purple-900 text-white transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-50 shadow-2xl">
        <!-- Logo Section -->
        <div class="flex items-center justify-center p-6 border-b border-indigo-700">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-vote-yea text-white text-lg"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold">VoteSystem</h2>
                    <p class="text-xs text-indigo-300">Secure Voting</p>
                </div>
            </div>
        </div>

        <!-- User Profile Section -->
        <div class="p-4 border-b border-indigo-700">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white text-lg"></i>
                </div>
                <div>
                    <p class="font-semibold text-sm" sec:authentication="principal.fullName">John Doe</p>
                    <p class="text-xs text-indigo-300" sec:authentication="name">username</p>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="mt-6">
            <ul class="space-y-2 px-4">
                <li>
                    <a href="/voter" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-700 transition-all duration-200">
                        <i class="fas fa-tachometer-alt text-lg"></i>
                        <span class="font-medium">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="/voter/profile" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-700 transition-all duration-200">
                        <i class="fas fa-user-circle text-lg"></i>
                        <span class="font-medium">My Profile</span>
                    </a>
                </li>
                <li>
                    <a href="/voter/elections" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-700 transition-all duration-200">
                        <i class="fas fa-calendar-check text-lg"></i>
                        <span class="font-medium">Elections</span>
                    </a>
                </li>

                <li>
                    <a href="/voter/results" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-700 transition-all duration-200">
                        <i class="fas fa-chart-bar text-lg"></i>
                        <span class="font-medium">Results</span>
                    </a>
                </li>
                <li>
                    <a href="/voter/history" class="flex items-center space-x-3 p-3 rounded-lg bg-indigo-700 text-white transition-all duration-200">
                        <i class="fas fa-history text-lg"></i>
                        <span class="font-medium">Vote History</span>
                    </a>
                </li>
                <li>
                    <a href="/voter/help" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-700 transition-all duration-200">
                        <i class="fas fa-question-circle text-lg"></i>
                        <span class="font-medium">Help & FAQ</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Logout Section -->
        <div class="absolute bottom-4 left-4 right-4">
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="w-full flex items-center justify-center space-x-2 p-3 bg-red-600 hover:bg-red-700 rounded-lg transition-all duration-200">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Main Content -->
    <div class="lg:ml-64 min-h-screen">
        <!-- Top Navigation Bar -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between p-4">
                <div class="flex items-center space-x-4">
                    <button onclick="toggleSidebar()" class="lg:hidden p-2 rounded-md hover:bg-gray-100">
                        <i class="fas fa-bars text-gray-600"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-800">Vote History</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <i class="fas fa-bell text-gray-600 text-lg cursor-pointer hover:text-indigo-600"></i>
                        <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full text-xs"></span>
                    </div>
                    <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                </div>
            </div>
        </header>

        <!-- History Content -->
        <main class="p-6">
            <!-- Page Header -->
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-8 text-white mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold mb-2">Your Voting History</h2>
                        <p class="text-indigo-100">Review all the elections you've participated in</p>
                    </div>
                    <div class="hidden md:block">
                        <i class="fas fa-history text-6xl text-indigo-200"></i>
                    </div>
                </div>
            </div>

            <!-- History Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-500">Total Votes Cast</h3>
                            <p class="text-2xl font-bold text-gray-900" th:text="${#lists.size(votedElections)}">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-calendar text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-500">Elections Participated</h3>
                            <p class="text-2xl font-bold text-gray-900" th:text="${#lists.size(votedElections)}">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-percentage text-purple-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-500">Participation Rate</h3>
                            <p class="text-2xl font-bold text-gray-900">100%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Voting History List -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">Your Voting Record</h3>
                </div>
                
                <div th:if="${#lists.isEmpty(votedElections)}" class="text-center py-12">
                    <i class="fas fa-vote-yea text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-500 mb-2">No Voting History</h3>
                    <p class="text-gray-400 mb-4">You haven't participated in any elections yet.</p>
                    <a href="/voter/elections" class="inline-flex items-center bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
                        <i class="fas fa-vote-yea mr-2"></i>
                        View Available Elections
                    </a>
                </div>

                <div th:if="${!#lists.isEmpty(votedElections)}" class="divide-y divide-gray-200">
                    <div th:each="election : ${votedElections}" class="p-6 hover:bg-gray-50 transition-colors">
                        <div class="flex items-center justify-between">
                            <div class="flex items-start space-x-4">
                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-lg font-semibold text-gray-900 mb-1" th:text="${election.name}">Student Council Election</h4>
                                    <p class="text-gray-600 text-sm mb-2" th:text="${election.description}">Choose your representatives for the upcoming academic year.</p>
                                    
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <div class="flex items-center">
                                            <i class="fas fa-calendar mr-1"></i>
                                            <span>Voted on: <span th:text="${#temporals.format(election.endTime, 'MMM dd, yyyy')}">Dec 20, 2024</span></span>
                                        </div>
                                        <div class="flex items-center">
                                            <i class="fas fa-clock mr-1"></i>
                                            <span th:text="${election.status}">Completed</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                    <i class="fas fa-check mr-1"></i>
                                    Vote Cast
                                </span>
                                
                                <div th:if="${election.status == 'completed' && election.resultsVisible}">
                                    <a th:href="@{/voter/elections/{id}/results(id=${election.id})}" 
                                       class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium hover:bg-blue-200 transition inline-flex items-center">
                                        <i class="fas fa-chart-bar mr-1"></i>
                                        View Results
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export Options -->
            <div th:if="${!#lists.isEmpty(votedElections)}" class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mt-8">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Export Your Data</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="exportAsPDF()" class="flex items-center bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition">
                        <i class="fas fa-file-pdf mr-2 text-red-600"></i>
                        Export as PDF
                    </button>
                    <button onclick="exportAsCSV()" class="flex items-center bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition">
                        <i class="fas fa-file-csv mr-2 text-green-600"></i>
                        Export as CSV
                    </button>
                    <button onclick="printHistory()" class="flex items-center bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition">
                        <i class="fas fa-print mr-2 text-blue-600"></i>
                        Print History
                    </button>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
